// ==UserScript==
// @name        UC Tournament View
// @version     0.1.0
// @author      JoanJuan10
// @description Plugin para UnderScript que mejora la vista de espectador en Undercards.net con plantillas modernas
// @homepage    https://github.com/JoanJuan10/UC_TournamentView
// @match       https://*.undercards.net/*
// @namespace   https://uc.feildmaster.com/
// @exclude     https://*.undercards.net/*/*
// @updateURL   https://github.com/JoanJuan10/UC_TournamentView/releases/latest/download/tournamentview.meta.js
// @downloadURL https://github.com/JoanJuan10/UC_TournamentView/releases/latest/download/tournamentview.user.js
// @require     https://raw.githubusercontent.com/UCProjects/UnderScript/master/src/checkerV2.js
// @grant       none
// ==/UserScript==

!function(e){var n={};function t(a){if(n[a])return n[a].exports;var o=n[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,t),o.l=!0,o.exports}t.m=e,t.c=n,t.d=function(e,n,a){t.o(e,n)||Object.defineProperty(e,n,{enumerable:!0,get:a})},t.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},t.t=function(e,n){if(1&n&&(e=t(e)),8&n)return e;if(4&n&&"object"==typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(t.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&n&&"string"!=typeof e)for(var o in e)t.d(a,o,function(n){return e[n]}.bind(null,o));return a},t.n=function(e){var n=e&&e.__esModule?function(){return e.default}:function(){return e};return t.d(n,"a",n),n},t.o=function(e,n){return Object.prototype.hasOwnProperty.call(e,n)},t.p="",t(t.s=0)}([function(e,n){const t=window.underscript,a=t.plugin("TournamentView",GM_info.version);const o=new class{constructor(){this.currentLanguage="es",this.translations={es:{"ui.turn":"Turno","ui.toggleHistory":"Mostrar/Ocultar Historial","ui.historyTitle":"Historial de Acciones","ui.waitingHistory":"Esperando historial del juego...","ui.noActions":"Sin acciones registradas aún","ui.totalTurns":"Turnos totales:","ui.finalHP":"HP Final:","ui.hand":"Mano","ui.deck":"Mazo","ui.graveyard":"Cementerio","result.victory":"¡VICTORIA!","result.defeat":"DERROTA","notif.receivedDamage":"{player} recibió {damage} de daño","notif.healed":"{player} sanó {heal} HP","notif.cardPlayed":"{player} jugó {card}","notif.spellCast":"{player} lanzó {spell}","notif.monsterDestroyed":"{monster} fue destruido","notif.artifactActivated":"Artefacto activado: {artifact}","notif.soulEffect":"Efecto de alma: {soul}","settings.enabled":"Activar Tournament View","settings.language":"Idioma","settings.languageDesc":"Seleccionar idioma de la interfaz","settings.template":"Plantilla Visual","settings.templateDesc":"Seleccionar estilo visual de la interfaz","settings.exportTemplate":"Exportar Plantilla","settings.exportTemplateDesc":"Descargar la plantilla actual como archivo JSON","settings.importTemplate":"Importar Plantilla","settings.importTemplateDesc":"Cargar una plantilla personalizada desde archivo","player.default":"Jugador","player.opponent":"Oponente"},en:{"ui.turn":"Turn","ui.toggleHistory":"Toggle History","ui.historyTitle":"Action History","ui.waitingHistory":"Waiting for game history...","ui.noActions":"No actions recorded yet","ui.totalTurns":"Total Turns:","ui.finalHP":"Final HP:","ui.hand":"Hand","ui.deck":"Deck","ui.graveyard":"Graveyard","result.victory":"VICTORY!","result.defeat":"DEFEAT","notif.receivedDamage":"{player} received {damage} damage","notif.healed":"{player} healed {heal} HP","notif.cardPlayed":"{player} played {card}","notif.spellCast":"{player} cast {spell}","notif.monsterDestroyed":"{monster} was destroyed","notif.artifactActivated":"Artifact activated: {artifact}","notif.soulEffect":"Soul effect: {soul}","settings.enabled":"Enable Tournament View","settings.language":"Language","settings.languageDesc":"Select interface language","settings.template":"Visual Template","settings.templateDesc":"Select interface visual style","settings.exportTemplate":"Export Template","settings.exportTemplateDesc":"Download current template as JSON file","settings.importTemplate":"Import Template","settings.importTemplateDesc":"Load custom template from file","player.default":"Player","player.opponent":"Opponent"}}}setLanguage(e){return this.translations[e]?(this.currentLanguage=e,console.log("[TournamentView] Idioma cambiado a: "+e),!0):(console.warn("[TournamentView] Idioma no soportado: "+e),!1)}t(e,n={}){return(this.translations[this.currentLanguage][e]||e).replace(/\{(\w+)\}/g,(e,t)=>void 0!==n[t]?n[t]:e)}};const r=new class{constructor(){this.reset()}reset(){this.isActive=!1,this.isSpectate=!1,this.player={id:null,username:"",hp:0,maxHp:0,gold:0,soul:"",soulLives:0,artifacts:[],handCount:0,deckCount:0,boardCount:0,graveyardCount:0},this.opponent={id:null,username:"",hp:0,maxHp:0,gold:0,soul:"",soulLives:0,artifacts:[],handCount:0,deckCount:0,boardCount:0,graveyardCount:0},this.turn=0,this.currentPlayer=null,this.gameResult=null}updatePlayer(e){void 0!==e.hp&&(this.player.hp=e.hp),void 0!==e.maxHp&&(this.player.maxHp=e.maxHp),void 0!==e.gold&&(this.player.gold=e.gold),void 0!==e.soul&&(this.player.soul=e.soul),void 0!==e.soulLives&&(this.player.soulLives=e.soulLives),void 0!==e.artifacts&&(this.player.artifacts=e.artifacts),void 0!==e.handCount&&(this.player.handCount=e.handCount),void 0!==e.deckCount&&(this.player.deckCount=e.deckCount),void 0!==e.boardCount&&(this.player.boardCount=e.boardCount),void 0!==e.graveyardCount&&(this.player.graveyardCount=e.graveyardCount)}updateOpponent(e){void 0!==e.hp&&(this.opponent.hp=e.hp),void 0!==e.maxHp&&(this.opponent.maxHp=e.maxHp),void 0!==e.gold&&(this.opponent.gold=e.gold),void 0!==e.soul&&(this.opponent.soul=e.soul),void 0!==e.soulLives&&(this.opponent.soulLives=e.soulLives),void 0!==e.artifacts&&(this.opponent.artifacts=e.artifacts),void 0!==e.handCount&&(this.opponent.handCount=e.handCount),void 0!==e.deckCount&&(this.opponent.deckCount=e.deckCount),void 0!==e.boardCount&&(this.opponent.boardCount=e.boardCount),void 0!==e.graveyardCount&&(this.opponent.graveyardCount=e.graveyardCount)}getState(){return{isActive:this.isActive,isSpectate:this.isSpectate,player:{...this.player},opponent:{...this.opponent},turn:this.turn,currentPlayer:this.currentPlayer,gameResult:this.gameResult}}};const i=new class{constructor(){this.templates=[],this.activeTemplate=null,this.cssElement=null,this.customTemplates=[],this.loadPredefinedTemplates(),this.loadCustomTemplates(),this.setActiveTemplate("default")}registerTemplate(e){if(!e.metadata||!e.metadata.id)return console.error("[TournamentView] Plantilla inválida: falta metadata.id"),!1;const n=this.templates.findIndex(n=>n.metadata.id===e.metadata.id);return n>=0?(this.templates[n]=e,console.log("[TournamentView] Plantilla actualizada:",e.metadata.id)):(this.templates.push(e),console.log("[TournamentView] Plantilla registrada:",e.metadata.id)),!0}loadPredefinedTemplates(){const e=this.createDefaultTemplate();this.registerTemplate(e);const n=this.createMinimalTemplate();this.registerTemplate(n);const t=this.createEsportsTemplate();this.registerTemplate(t),console.log("[TournamentView] Plantillas predefinidas cargadas:",this.templates.length)}loadCustomTemplates(){try{const e=localStorage.getItem("uc_tournament_custom_templates");if(e){const n=JSON.parse(e);this.customTemplates=Array.isArray(n)?n:[],this.customTemplates.forEach(e=>{this.registerTemplate(e)}),console.log("[TournamentView] Plantillas custom cargadas:",this.customTemplates.length)}}catch(e){console.error("[TournamentView] Error cargando plantillas custom:",e),this.customTemplates=[]}}setActiveTemplate(e){const n=this.getTemplateById(e);return n?(this.activeTemplate=n,console.log("[TournamentView] Plantilla activa:",n.metadata.name),!0):(console.error("[TournamentView] Plantilla no encontrada:",e),!1)}getTemplateById(e){return this.templates.find(n=>n.metadata.id===e)||null}listTemplates(){return this.templates.map(e=>({id:e.metadata.id,name:e.metadata.name,author:e.metadata.author,description:e.metadata.description,isCustom:this.customTemplates.some(n=>n.metadata.id===e.metadata.id)}))}getAllTemplateIds(){return this.templates.map(e=>e.metadata.id)}getActiveTemplateId(){return this.activeTemplate?this.activeTemplate.metadata.id:null}deleteTemplate(e){if(["default","minimal","esports"].includes(e))return console.error("[TournamentView] No se pueden eliminar plantillas predefinidas"),!1;const n=this.templates.findIndex(n=>n.metadata.id===e);if(n>=0){this.templates.splice(n,1),console.log("[TournamentView] Plantilla eliminada:",e);const t=this.customTemplates.findIndex(n=>n.metadata.id===e);return t>=0&&this.customTemplates.splice(t,1),this.saveCustomTemplates(),!0}return console.error("[TournamentView] Plantilla no encontrada:",e),!1}exportTemplate(e){const n=this.getTemplateById(e);return n?{success:!0,data:JSON.stringify(n,null,2)}:{success:!1,error:"Plantilla no encontrada"}}importTemplate(e){try{const n=JSON.parse(e),t=this.validateTemplate(n);return t.valid?(this.registerTemplate(n),this.saveCustomTemplate(n),{success:!0,template:n}):{success:!1,error:"Plantilla inválida: "+t.errors.join(", ")}}catch(e){return{success:!1,error:"Error parseando JSON: "+e.message}}}validateTemplate(e){const n=[];if(e.metadata?(e.metadata.id||n.push("Falta metadata.id"),e.metadata.name||n.push("Falta metadata.name"),e.metadata.version||n.push("Falta metadata.version")):n.push('Falta sección "metadata"'),e.variables){["primaryColor","secondaryColor","backgroundColor","textColor"].forEach(t=>{e.variables[t]||n.push("Falta variable requerida: "+t)})}else n.push('Falta sección "variables"');return e.customCSS&&"string"!=typeof e.customCSS&&n.push("customCSS debe ser un string"),{valid:0===n.length,errors:n}}saveCustomTemplate(e){const n=this.customTemplates.findIndex(n=>n.metadata.id===e.metadata.id);n>=0?this.customTemplates[n]=e:this.customTemplates.push(e);try{localStorage.setItem("uc_tournament_custom_templates",JSON.stringify(this.customTemplates)),console.log("[TournamentView] Plantilla custom guardada:",e.metadata.id)}catch(e){console.error("[TournamentView] Error guardando plantilla custom:",e)}}deleteCustomTemplate(e){this.customTemplates=this.customTemplates.filter(n=>n.metadata.id!==e),this.templates=this.templates.filter(n=>n.metadata.id!==e);try{return localStorage.setItem("uc_tournament_custom_templates",JSON.stringify(this.customTemplates)),console.log("[TournamentView] Plantilla custom eliminada:",e),!0}catch(e){return console.error("[TournamentView] Error eliminando plantilla custom:",e),!1}}injectCSS(){if(!this.activeTemplate)return void console.error("[TournamentView] No hay plantilla activa");const e=this.generateCSSVariables(),n=`\n${e}\n${this.activeTemplate.customCSS||""}\n`;this.cssElement&&this.cssElement.replace?this.cssElement.replace(n):this.cssElement=a.addStyle(n),console.log("[TournamentView] CSS inyectado -",this.activeTemplate.metadata.name),console.log("[TournamentView] CSS Variables:",e.substring(0,200)),console.log("[TournamentView] CSS Length:",n.length,"chars"),console.log("[TournamentView] CSS Element:",this.cssElement),console.log("[TournamentView] CSS Element tagName:",this.cssElement?this.cssElement.tagName:"null"),console.log("[TournamentView] CSS Element in DOM:",this.cssElement&&null!==this.cssElement.parentNode),console.log("[TournamentView] CSS First 500 chars:",n.substring(0,500))}removeCSS(){this.cssElement&&this.cssElement.parentNode&&this.cssElement.remove(),this.cssElement=null,console.log("[TournamentView] CSS removido")}generateCSSVariables(){if(!this.activeTemplate||!this.activeTemplate.variables)return"";const e=this.activeTemplate.variables;let n=":root {\n";for(const[t,a]of Object.entries(e)){n+=`  --tv-${t.replace(/([A-Z])/g,"-$1").toLowerCase()}: ${a};\n`}return n+="}\n",n}createDefaultTemplate(){return{metadata:{id:"default",name:"Default Tournament View",version:"1.0.0",author:"JoanJuan10",description:"Plantilla por defecto con diseño moderno y gradientes vibrantes",created:"2025-12-24",modified:"2025-12-24",tags:["default","modern","gradient"]},variables:{primaryColor:"#667eea",secondaryColor:"#764ba2",accentColor:"#f093fb",backgroundColor:"#0f0f23",textColor:"#ffffff"},customCSS:"\n/* Ocultar historiales nativos de Underscript y Undercards */\n#history {\n    display: none !important;\n}\n\n#game-history {\n    display: none !important;\n}\n\n/* \n * TABLERO DE JUEGO - Ajuste de posición\n * \n * NOTA FASE 4: Este elemento .mainContent y todos sus subelementos deberán ser gestionables\n * en el sistema de plantillas. Incluye:\n * - Avatares (#enemyAvatar, #yourAvatar)\n * - Fases del juego (#phase1, #phase2)\n * - Perfiles de jugadores (.profile)\n * - Tablero de juego (#board con celdas y cartas)\n * - Información de HP, ORO, cartas en mano/mazo\n * - Timer (.timer)\n * - Cartas en mano (#handCards)\n * - Emotes (bubbles y emotes)\n * \n * Propiedades configurables en plantillas:\n * - Posición vertical (margin-top)\n * - Escala/zoom (transform: scale)\n * - Opacidad durante overlay\n * - Filtros visuales (blur, brightness)\n */\n.mainContent {\n    margin-top: 100px !important;\n}\n\n/* Tournament View Base Styles */\n#uc-tournament-view {\n    font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;\n    color: var(--tv-text-color, #ffffff);\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    z-index: 9999;\n    pointer-events: none;\n}\n\n#uc-tournament-view * {\n    box-sizing: border-box;\n}\n\n/* Header Bar */\n.tv-header {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 80px;\n    background: linear-gradient(135deg, var(--tv-primary-color) 0%, var(--tv-secondary-color) 100%);\n    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 0 1.5rem;\n    pointer-events: auto;\n}\n\n.tv-player-info {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    flex: 1;\n    position: relative;\n    transition: all 0.3s ease;\n}\n\n.tv-player-info.active-turn::before {\n    content: '';\n    position: absolute;\n    top: -8px;\n    left: -8px;\n    right: -8px;\n    bottom: -8px;\n    border: 3px solid #fbbf24;\n    border-radius: 12px;\n    animation: pulse-border 2s infinite;\n    pointer-events: none;\n}\n\n@keyframes pulse-border {\n    0%, 100% {\n        opacity: 1;\n        transform: scale(1);\n    }\n    50% {\n        opacity: 0.7;\n        transform: scale(1.02);\n    }\n}\n\n@keyframes shake {\n    0%, 100% { transform: translateX(0); }\n    25% { transform: translateX(-4px); }\n    50% { transform: translateX(4px); }\n    75% { transform: translateX(-4px); }\n}\n\n@keyframes slideInRight {\n    from {\n        right: -350px;\n        opacity: 0;\n    }\n    to {\n        right: 20px;\n        opacity: 1;\n    }\n}\n\n@keyframes slideOutRight {\n    from {\n        right: 20px;\n        opacity: 1;\n    }\n    to {\n        right: -350px;\n        opacity: 0;\n    }\n}\n\n@keyframes bounce {\n    0%, 100% { transform: translateY(0); }\n    50% { transform: translateY(-5px); }\n}\n\n@keyframes glow {\n    0%, 100% {\n        box-shadow: 0 0 5px currentColor;\n    }\n    50% {\n        box-shadow: 0 0 20px currentColor, 0 0 30px currentColor;\n    }\n}\n\n@keyframes artifactPulse {\n    0%, 100% {\n        transform: scale(1);\n        filter: drop-shadow(0 0 5px #fbbf24);\n    }\n    50% {\n        transform: scale(1.1);\n        filter: drop-shadow(0 0 15px #fbbf24) drop-shadow(0 0 25px #fbbf24);\n    }\n}\n\n.tv-player-name {\n    font-size: 1.5rem;\n    font-weight: bold;\n    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.5);\n    letter-spacing: 0.5px;\n}\n\n.tv-player-hp {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    background: rgba(0, 0, 0, 0.3);\n    padding: 0.5rem 1rem;\n    border-radius: 8px;\n    backdrop-filter: blur(10px);\n}\n\n.tv-hp-bar {\n    width: 120px;\n    height: 12px;\n    background: rgba(0, 0, 0, 0.5);\n    border-radius: 6px;\n    overflow: hidden;\n    position: relative;\n}\n\n.tv-hp-fill {\n    height: 100%;\n    background: linear-gradient(90deg, #ef4444 0%, #f59e0b 50%, #10b981 100%);\n    transition: width 0.3s ease;\n    box-shadow: 0 0 10px rgba(239, 68, 68, 0.5);\n}\n\n.tv-hp-fill.hp-damage {\n    animation: shake 0.3s ease;\n    box-shadow: 0 0 20px rgba(239, 68, 68, 0.8);\n}\n\n.tv-hp-fill.hp-heal {\n    animation: bounce 0.5s ease;\n    box-shadow: 0 0 20px rgba(16, 185, 129, 0.8);\n}\n\n.tv-soul-image.soul-glow {\n    animation: glow 0.5s ease 2;\n    color: #3b82f6;\n}\n\n.tv-artifact-image.artifact-glow {\n    animation: artifactPulse 0.6s ease 2;\n}\n\n.tv-hp-text {\n    font-size: 0.875rem;\n    font-weight: bold;\n    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);\n    min-width: 50px;\n    text-align: center;\n}\n\n.tv-player-gold {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    background: rgba(0, 0, 0, 0.3);\n    padding: 0.5rem 1rem;\n    border-radius: 8px;\n    backdrop-filter: blur(10px);\n}\n\n.tv-gold-text {\n    font-size: 1rem;\n    font-weight: bold;\n    color: var(--tv-accent-color, #f093fb);\n    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);\n}\n\n.tv-player-soul {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    background: rgba(0, 0, 0, 0.3);\n    padding: 0.5rem 1rem;\n    border-radius: 8px;\n    backdrop-filter: blur(10px);\n}\n\n.tv-soul-text {\n    font-size: 0.875rem;\n    font-weight: bold;\n    color: #fbbf24;\n    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);\n    text-transform: uppercase;\n}\n\n.tv-player-artifacts {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    background: rgba(0, 0, 0, 0.3);\n    padding: 0.5rem 1rem;\n    border-radius: 8px;\n    backdrop-filter: blur(10px);\n    flex-wrap: wrap;\n}\n\n.tv-artifacts-text {\n    font-size: 0.75rem;\n    font-weight: bold;\n    color: #a78bfa;\n    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);\n    overflow: hidden;\n    text-overflow: ellipsis;\n    white-space: nowrap;\n}\n\n.tv-player-cards {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    background: rgba(0, 0, 0, 0.3);\n    padding: 0.5rem 1rem;\n    border-radius: 8px;\n    backdrop-filter: blur(10px);\n}\n\n.tv-card-counter {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 0.25rem;\n}\n\n.tv-card-counter-label {\n    font-size: 0.625rem;\n    color: #a0a0b0;\n    text-transform: uppercase;\n    letter-spacing: 0.5px;\n}\n\n.tv-card-counter-value {\n    font-size: 1rem;\n    font-weight: bold;\n    color: #ffffff;\n    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);\n}\n\n/* Center Info */\n.tv-center-info {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.tv-turn-indicator {\n    background: rgba(0, 0, 0, 0.4);\n    padding: 0.5rem 1.5rem;\n    border-radius: 8px;\n    backdrop-filter: blur(10px);\n    text-align: center;\n}\n\n.tv-turn-label {\n    font-size: 0.875rem;\n    color: #a0a0b0;\n    text-transform: uppercase;\n    letter-spacing: 1px;\n}\n\n.tv-turn-number {\n    font-size: 1.5rem;\n    font-weight: bold;\n    color: var(--tv-accent-color, #f093fb);\n    text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.8);\n}\n\n.tv-turn-timer {\n    font-size: 0.875rem;\n    color: #fbbf24;\n    font-weight: bold;\n    text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.8);\n    min-width: 30px;\n    text-align: center;\n}\n\n.tv-turn-timer.low {\n    color: #ef4444;\n    animation: pulse 1s infinite;\n}\n\n@keyframes pulse {\n    0%, 100% { opacity: 1; }\n    50% { opacity: 0.5; }\n}\n\n/* Opponent Info */\n.tv-opponent-info {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    flex: 1;\n    justify-content: flex-end;\n    flex-direction: row-reverse;\n    position: relative;\n    transition: all 0.3s ease;\n}\n\n.tv-opponent-info.active-turn::before {\n    content: '';\n    position: absolute;\n    top: -8px;\n    left: -8px;\n    right: -8px;\n    bottom: -8px;\n    border: 3px solid #fbbf24;\n    border-radius: 12px;\n    animation: pulse-border 2s infinite;\n    pointer-events: none;\n}\n\n/* Result Overlay */\n.tv-result-overlay {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(0, 0, 0, 0.8);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    backdrop-filter: blur(5px);\n    pointer-events: auto;\n    animation: fadeIn 0.5s ease;\n}\n\n@keyframes fadeIn {\n    from { opacity: 0; }\n    to { opacity: 1; }\n}\n\n.tv-result-container {\n    background: linear-gradient(135deg, #1a1a2e 0%, var(--tv-background-color) 100%);\n    border: 2px solid #2a2a3e;\n    border-radius: 8px;\n    padding: 2rem 3rem;\n    box-shadow: 0 8px 16px rgba(0, 0, 0, 0.3);\n    text-align: center;\n    animation: scaleIn 0.5s ease;\n    min-width: 400px;\n}\n\n@keyframes scaleIn {\n    from {\n        opacity: 0;\n        transform: scale(0.8);\n    }\n    to {\n        opacity: 1;\n        transform: scale(1);\n    }\n}\n\n.tv-result-title {\n    font-size: 3rem;\n    font-weight: bold;\n    margin-bottom: 1.5rem;\n    text-shadow: 3px 3px 6px rgba(0, 0, 0, 0.8);\n}\n\n.tv-result-title.victory {\n    color: #10b981;\n    text-shadow: 0 0 20px rgba(16, 185, 129, 0.5);\n}\n\n.tv-result-title.defeat {\n    color: #ef4444;\n    text-shadow: 0 0 20px rgba(239, 68, 68, 0.5);\n}\n\n.tv-result-stats {\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n    margin-top: 1.5rem;\n}\n\n.tv-result-stat {\n    display: flex;\n    justify-content: space-between;\n    padding: 0.5rem 1rem;\n    background: rgba(0, 0, 0, 0.3);\n    border-radius: 4px;\n}\n\n.tv-result-stat-label {\n    color: #a0a0b0;\n}\n\n.tv-result-stat-value {\n    color: var(--tv-text-color, #ffffff);\n    font-weight: bold;\n}\n\n/* Notificaciones Flotantes */\n.tv-notification {\n    position: fixed;\n    top: 90px;\n    right: 20px;\n    padding: 1rem 1.5rem;\n    border-radius: 10px;\n    color: white;\n    font-weight: 600;\n    font-size: 1.1rem;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n    z-index: 10001;\n    animation: slideInRight 0.3s ease forwards;\n    margin-bottom: 10px;\n    backdrop-filter: blur(10px);\n    max-width: 400px;\n    word-wrap: break-word;\n}\n\n.tv-notification.hiding {\n    animation: slideOutRight 0.3s ease forwards;\n}\n\n.tv-notification-info {\n    background: linear-gradient(135deg, rgba(59, 130, 246, 0.9), rgba(37, 99, 235, 0.9));\n}\n\n.tv-notification-card {\n    background: linear-gradient(135deg, rgba(16, 185, 129, 0.9), rgba(5, 150, 105, 0.9));\n}\n\n.tv-notification-spell {\n    background: linear-gradient(135deg, rgba(139, 92, 246, 0.9), rgba(109, 40, 217, 0.9));\n}\n\n.tv-notification-damage {\n    background: linear-gradient(135deg, rgba(239, 68, 68, 0.9), rgba(220, 38, 38, 0.9));\n}\n\n.tv-notification-heal {\n    background: linear-gradient(135deg, rgba(16, 185, 129, 0.9), rgba(5, 150, 105, 0.9));\n}\n\n.tv-notification-artifact {\n    background: linear-gradient(135deg, rgba(251, 191, 36, 0.9), rgba(245, 158, 11, 0.9));\n}\n\n/* Panel de Historial */\n.tv-action-log {\n    position: fixed;\n    top: 90px;\n    right: 0;\n    width: 450px;\n    max-height: calc(100vh - 100px);\n    background: linear-gradient(135deg, rgba(15, 15, 35, 0.95), rgba(30, 30, 60, 0.95));\n    backdrop-filter: blur(10px);\n    border-radius: 12px 0 0 12px;\n    box-shadow: -4px 0 20px rgba(0, 0, 0, 0.5);\n    z-index: 9999;\n    transition: transform 0.3s ease;\n    display: flex;\n    flex-direction: column;\n}\n\n.tv-action-log.collapsed {\n    transform: translateX(450px);\n}\n\n.tv-log-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 1rem;\n    background: linear-gradient(135deg, var(--tv-primary-color), var(--tv-secondary-color));\n    border-radius: 12px 0 0 0;\n    color: white;\n    font-weight: bold;\n    font-size: 1.2rem;\n}\n\n.tv-log-toggle {\n    background: rgba(255, 255, 255, 0.2);\n    border: none;\n    color: white;\n    width: 28px;\n    height: 28px;\n    border-radius: 50%;\n    cursor: pointer;\n    font-size: 1.2rem;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    transition: all 0.2s ease;\n}\n\n.tv-log-toggle:hover {\n    background: rgba(255, 255, 255, 0.3);\n    transform: scale(1.1);\n}\n\n.tv-log-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 0.5rem;\n}\n\n.tv-log-content::-webkit-scrollbar {\n    width: 6px;\n}\n\n.tv-log-content::-webkit-scrollbar-track {\n    background: rgba(0, 0, 0, 0.2);\n    border-radius: 3px;\n}\n\n.tv-log-content::-webkit-scrollbar-thumb {\n    background: var(--tv-accent-color);\n    border-radius: 3px;\n}\n\n.tv-log-entry {\n    padding: 0.75rem 1rem;\n    margin-bottom: 0.7rem;\n    border-radius: 6px;\n    background: rgba(255, 255, 255, 0.05);\n    border-left: 3px solid var(--tv-accent-color);\n    font-size: 1.1rem;\n    color: rgba(255, 255, 255, 0.9);\n    animation: fadeIn 0.3s ease;\n    line-height: 1.8;\n}\n\n/* Estilos para el contenido HTML de Underscript dentro de las entradas */\n.tv-log-entry img {\n    width: 22px;\n    height: 22px;\n    vertical-align: middle;\n    margin: 0 3px;\n    display: inline-block;\n}\n\n.tv-log-entry span {\n    vertical-align: middle;\n}\n\n.tv-log-entry span[style*=\"text-decoration: underline\"] {\n    color: #fbbf24;\n    font-weight: 500;\n}\n\n/* Clases de almas de Underscript */\n.tv-log-entry .DETERMINATION {\n    color: #ff0000;\n}\n\n.tv-log-entry .BRAVERY {\n    color: #ff8800;\n}\n\n.tv-log-entry .JUSTICE {\n    color: #ffff00;\n}\n\n.tv-log-entry .KINDNESS {\n    color: #00ff00;\n}\n\n.tv-log-entry .PATIENCE {\n    color: #00ffff;\n}\n\n.tv-log-entry .INTEGRITY {\n    color: #0000ff;\n}\n\n.tv-log-entry .PERSEVERANCE {\n    color: #ff00ff;\n}\n\n.tv-log-entry-turn {\n    border-left-color: #fbbf24;\n    background: rgba(251, 191, 36, 0.1);\n    font-weight: bold;\n}\n\n.tv-log-entry-hp {\n    border-left-color: #ef4444;\n    background: rgba(239, 68, 68, 0.08);\n}\n\n.tv-log-entry-heal {\n    border-left-color: #10b981;\n    background: rgba(16, 185, 129, 0.08);\n}\n\n.tv-log-entry-card {\n    border-left-color: #10b981;\n    background: rgba(16, 185, 129, 0.05);\n}\n\n.tv-log-entry-spell {\n    border-left-color: #8b5cf6;\n    background: rgba(139, 92, 246, 0.08);\n}\n\n.tv-log-entry-artifact {\n    border-left-color: #fbbf24;\n    background: rgba(251, 191, 36, 0.08);\n}\n\n.tv-log-entry-soul {\n    border-left-color: #3b82f6;\n    background: rgba(59, 130, 246, 0.08);\n}\n\n.tv-log-entry-damage {\n    border-left-color: #dc2626;\n    background: rgba(220, 38, 38, 0.08);\n}\n\n.tv-log-turn {\n    color: #fbbf24;\n    font-weight: bold;\n    font-size: 0.75rem;\n}\n\n.tv-log-player {\n    color: var(--tv-accent-color);\n    font-weight: 600;\n}\n\n.tv-log-message {\n    margin-top: 0.25rem;\n}\n\n/* Botón Toggle Flotante para Historial */\n.tv-log-float-toggle {\n    position: fixed;\n    top: 100px;\n    right: 10px;\n    width: 40px;\n    height: 40px;\n    background: linear-gradient(135deg, var(--tv-primary-color), var(--tv-secondary-color));\n    border: none;\n    border-radius: 50%;\n    color: white;\n    font-size: 1.2rem;\n    cursor: pointer;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);\n    z-index: 10000;\n    transition: all 0.3s ease;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n}\n\n.tv-log-float-toggle:hover {\n    transform: scale(1.1);\n    box-shadow: 0 6px 16px rgba(0, 0, 0, 0.4);\n}\n\n/* Responsive Design */\n@media (max-width: 1280px) {\n    .tv-header {\n        height: 60px;\n        padding: 0 1rem;\n    }\n    \n    .tv-player-name {\n        font-size: 1.2rem;\n    }\n    \n    .tv-hp-bar {\n        width: 100px;\n    }\n    \n    .tv-card-counter-label {\n        font-size: 0.5rem;\n    }\n    \n    .tv-artifact-image {\n        width: 30px;\n        height: 30px;\n    }\n}\n\n@media (max-width: 768px) {\n    .tv-header {\n        height: auto;\n        flex-direction: column;\n        padding: 0.5rem;\n        gap: 0.5rem;\n    }\n    \n    .tv-player-info,\n    .tv-opponent-info {\n        width: 100%;\n        justify-content: space-between;\n    }\n    \n    .tv-turn-info {\n        width: 100%;\n        order: -1;\n    }\n    \n    .tv-result-container {\n        min-width: 90vw;\n        padding: 1.5rem;\n    }\n    \n    .tv-action-log {\n        width: 100%;\n        max-height: 50vh;\n        border-radius: 12px 12px 0 0;\n        top: auto;\n        bottom: 0;\n    }\n    \n    .tv-action-log.collapsed {\n        transform: translateY(100%);\n    }\n    \n    .tv-notification {\n        max-width: calc(100vw - 40px);\n        right: 10px;\n    }\n}\n\n@media (max-width: 480px) {\n    .tv-player-name {\n        font-size: 1rem;\n    }\n    \n    .tv-hp-bar {\n        width: 80px;\n        height: 10px;\n    }\n    \n    .tv-card-counters {\n        gap: 0.25rem;\n    }\n    \n    .tv-artifact-image {\n        width: 24px;\n        height: 24px;\n    }\n    \n    .tv-soul-image {\n        width: 20px;\n        height: 20px;\n    }\n}\n"}}createMinimalTemplate(){return{metadata:{id:"minimal",name:"Minimal Clean",version:"1.0.0",author:"JoanJuan10",description:"Diseño minimalista con colores planos y solo información esencial",created:"2025-12-24",modified:"2025-12-24",tags:["minimal","clean","simple"]},variables:{primaryColor:"#2c3e50",secondaryColor:"#34495e",accentColor:"#3498db",backgroundColor:"#ecf0f1",textColor:"#2c3e50"},customCSS:"\n/* Ocultar historiales nativos */\n#history,\n#game-history {\n    display: none !important;\n}\n\n.mainContent {\n    margin-top: 100px !important;\n}\n\n/* Minimal Base */\n#uc-tournament-view {\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, sans-serif;\n    color: var(--tv-text-color);\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    z-index: 9999;\n    pointer-events: none;\n}\n\n#uc-tournament-view * {\n    box-sizing: border-box;\n}\n\n/* Header minimalista */\n.tv-header {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 60px;\n    background: var(--tv-primary-color);\n    border-bottom: 2px solid var(--tv-accent-color);\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 0 2rem;\n    pointer-events: auto;\n}\n\n.tv-player-info {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    flex: 1;\n}\n\n.tv-player-info.active-turn {\n    opacity: 1;\n}\n\n.tv-player-name {\n    font-size: 1.25rem;\n    font-weight: 600;\n    color: white;\n}\n\n.tv-player-hp {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    background: rgba(255, 255, 255, 0.1);\n    padding: 0.4rem 0.8rem;\n    border-radius: 4px;\n}\n\n.tv-hp-bar {\n    width: 100px;\n    height: 8px;\n    background: rgba(0, 0, 0, 0.2);\n    border-radius: 4px;\n    overflow: hidden;\n}\n\n.tv-hp-fill {\n    height: 100%;\n    background: var(--tv-accent-color);\n    transition: width 0.3s ease;\n}\n\n.tv-hp-text {\n    font-size: 0.875rem;\n    font-weight: 600;\n    color: white;\n    min-width: 50px;\n}\n\n.tv-player-gold {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    background: rgba(255, 255, 255, 0.1);\n    padding: 0.4rem 0.8rem;\n    border-radius: 4px;\n}\n\n.tv-gold-text {\n    font-size: 0.875rem;\n    font-weight: 600;\n    color: #f39c12;\n}\n\n.tv-player-soul {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.tv-soul-image {\n    width: 24px;\n    height: 24px;\n}\n\n.tv-player-artifacts {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    flex-wrap: wrap;\n}\n\n.tv-artifact-image {\n    width: 28px;\n    height: 28px;\n    border-radius: 4px;\n}\n\n.tv-artifact-counter {\n    position: absolute;\n    top: -4px;\n    right: -4px;\n    background: var(--tv-accent-color);\n    color: white;\n    border-radius: 50%;\n    width: 16px;\n    height: 16px;\n    font-size: 0.625rem;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-weight: bold;\n}\n\n.tv-player-cards {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n}\n\n.tv-card-counter {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n}\n\n.tv-card-counter-label {\n    font-size: 0.625rem;\n    color: rgba(255, 255, 255, 0.6);\n    text-transform: uppercase;\n}\n\n.tv-card-counter-value {\n    font-size: 0.875rem;\n    font-weight: 600;\n    color: white;\n}\n\n/* Center Info */\n.tv-center-info {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n}\n\n.tv-turn-indicator {\n    background: rgba(255, 255, 255, 0.1);\n    padding: 0.4rem 1rem;\n    border-radius: 4px;\n}\n\n.tv-turn-label {\n    font-size: 0.75rem;\n    color: rgba(255, 255, 255, 0.6);\n    text-transform: uppercase;\n}\n\n.tv-turn-number {\n    font-size: 1.25rem;\n    font-weight: 700;\n    color: white;\n}\n\n.tv-turn-timer {\n    font-size: 0.875rem;\n    color: white;\n    font-weight: 600;\n}\n\n.tv-turn-timer.low {\n    color: #e74c3c;\n}\n\n/* Opponent Info */\n.tv-opponent-info {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    flex: 1;\n    justify-content: flex-end;\n    flex-direction: row-reverse;\n}\n\n/* Notificaciones simples */\n.tv-notification {\n    position: fixed;\n    top: 70px;\n    right: 20px;\n    padding: 0.75rem 1.25rem;\n    border-radius: 4px;\n    color: white;\n    font-weight: 500;\n    font-size: 0.875rem;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);\n    z-index: 10001;\n    background: var(--tv-accent-color);\n    max-width: 300px;\n}\n\n/* Panel de historial simple */\n.tv-action-log {\n    position: fixed;\n    top: 70px;\n    right: 0;\n    width: 350px;\n    max-height: calc(100vh - 80px);\n    background: white;\n    border-left: 2px solid var(--tv-accent-color);\n    z-index: 9999;\n    transition: transform 0.3s ease;\n    display: flex;\n    flex-direction: column;\n}\n\n.tv-action-log.collapsed {\n    transform: translateX(350px);\n}\n\n.tv-log-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 0.75rem 1rem;\n    background: var(--tv-primary-color);\n    color: white;\n    font-weight: 600;\n    font-size: 1rem;\n}\n\n.tv-log-toggle {\n    background: transparent;\n    border: 1px solid rgba(255, 255, 255, 0.3);\n    color: white;\n    width: 24px;\n    height: 24px;\n    border-radius: 4px;\n    cursor: pointer;\n    font-size: 0.875rem;\n}\n\n.tv-log-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 0.5rem;\n}\n\n.tv-log-entry {\n    padding: 0.5rem 0.75rem;\n    margin-bottom: 0.5rem;\n    border-radius: 4px;\n    background: #f8f9fa;\n    border-left: 3px solid var(--tv-accent-color);\n    font-size: 0.875rem;\n    color: var(--tv-text-color);\n    line-height: 1.5;\n}\n\n/* Botón flotante simple */\n.tv-log-float-toggle {\n    position: fixed;\n    top: 70px;\n    right: 10px;\n    width: 36px;\n    height: 36px;\n    background: var(--tv-accent-color);\n    border: none;\n    border-radius: 4px;\n    color: white;\n    font-size: 1rem;\n    cursor: pointer;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);\n    z-index: 10000;\n}\n\n/* Result overlay minimalista */\n.tv-result-overlay {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: rgba(255, 255, 255, 0.95);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    pointer-events: auto;\n}\n\n.tv-result-container {\n    background: white;\n    border: 2px solid var(--tv-primary-color);\n    border-radius: 8px;\n    padding: 2rem 3rem;\n    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.1);\n    text-align: center;\n    min-width: 350px;\n}\n\n.tv-result-title {\n    font-size: 2.5rem;\n    font-weight: 700;\n    margin-bottom: 1rem;\n    color: var(--tv-text-color);\n}\n\n.tv-result-title.victory {\n    color: #27ae60;\n}\n\n.tv-result-title.defeat {\n    color: #e74c3c;\n}\n\n.tv-result-stats {\n    display: flex;\n    flex-direction: column;\n    gap: 0.75rem;\n    margin-top: 1rem;\n}\n\n.tv-result-stat {\n    display: flex;\n    justify-content: space-between;\n    padding: 0.5rem 1rem;\n    background: #f8f9fa;\n    border-radius: 4px;\n}\n\n.tv-result-stat-label {\n    color: #7f8c8d;\n    font-weight: 500;\n}\n\n.tv-result-stat-value {\n    color: var(--tv-text-color);\n    font-weight: 600;\n}\n\n/* Responsive */\n@media (max-width: 1280px) {\n    .tv-header {\n        height: 50px;\n        padding: 0 1rem;\n    }\n    \n    .tv-player-name {\n        font-size: 1rem;\n    }\n}\n\n@media (max-width: 768px) {\n    .tv-header {\n        height: auto;\n        flex-direction: column;\n        padding: 0.5rem;\n        gap: 0.5rem;\n    }\n    \n    .tv-player-info,\n    .tv-opponent-info {\n        width: 100%;\n    }\n}\n"}}createEsportsTemplate(){return{metadata:{id:"esports",name:"Esports Broadcast",version:"1.0.0",author:"JoanJuan10",description:"Estilo de transmisión profesional con efectos dramáticos y colores corporativos",created:"2025-12-24",modified:"2025-12-24",tags:["esports","professional","broadcast"]},variables:{primaryColor:"#0a1929",secondaryColor:"#1a2332",accentColor:"#ffd700",backgroundColor:"#000814",textColor:"#ffffff"},customCSS:"\n/* Ocultar historiales nativos */\n#history,\n#game-history {\n    display: none !important;\n}\n\n.mainContent {\n    margin-top: 120px !important;\n}\n\n/* Esports Base */\n#uc-tournament-view {\n    font-family: 'Roboto', 'Arial Black', sans-serif;\n    color: var(--tv-text-color);\n    position: fixed;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    z-index: 9999;\n    pointer-events: none;\n}\n\n#uc-tournament-view * {\n    box-sizing: border-box;\n}\n\n/* Header estilo broadcast */\n.tv-header {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    height: 100px;\n    background: linear-gradient(180deg, var(--tv-primary-color) 0%, var(--tv-secondary-color) 100%);\n    border-bottom: 4px solid var(--tv-accent-color);\n    box-shadow: 0 4px 20px rgba(0, 0, 0, 0.7), inset 0 -2px 0 rgba(255, 215, 0, 0.3);\n    display: flex;\n    align-items: center;\n    justify-content: space-between;\n    padding: 0 2rem;\n    pointer-events: auto;\n}\n\n.tv-player-info {\n    display: flex;\n    align-items: center;\n    gap: 1.5rem;\n    flex: 1;\n    position: relative;\n}\n\n.tv-player-info.active-turn::before {\n    content: '';\n    position: absolute;\n    top: -12px;\n    left: -12px;\n    right: -12px;\n    bottom: -12px;\n    border: 4px solid var(--tv-accent-color);\n    border-radius: 8px;\n    box-shadow: 0 0 30px rgba(255, 215, 0, 0.6), inset 0 0 20px rgba(255, 215, 0, 0.2);\n    animation: pulse-glow 2s infinite;\n}\n\n@keyframes pulse-glow {\n    0%, 100% {\n        opacity: 1;\n        box-shadow: 0 0 30px rgba(255, 215, 0, 0.6), inset 0 0 20px rgba(255, 215, 0, 0.2);\n    }\n    50% {\n        opacity: 0.8;\n        box-shadow: 0 0 50px rgba(255, 215, 0, 0.8), inset 0 0 30px rgba(255, 215, 0, 0.3);\n    }\n}\n\n.tv-player-name {\n    font-size: 1.75rem;\n    font-weight: 900;\n    text-transform: uppercase;\n    letter-spacing: 2px;\n    background: linear-gradient(135deg, #ffffff 0%, var(--tv-accent-color) 100%);\n    -webkit-background-clip: text;\n    -webkit-text-fill-color: transparent;\n    background-clip: text;\n    text-shadow: 0 0 20px rgba(255, 215, 0, 0.5);\n    filter: drop-shadow(2px 2px 4px rgba(0, 0, 0, 0.8));\n}\n\n.tv-player-hp {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    background: linear-gradient(135deg, rgba(0, 0, 0, 0.5) 0%, rgba(0, 0, 0, 0.3) 100%);\n    padding: 0.75rem 1.25rem;\n    border-radius: 6px;\n    border: 2px solid rgba(255, 215, 0, 0.3);\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.5), inset 0 1px 0 rgba(255, 255, 255, 0.1);\n}\n\n.tv-hp-bar {\n    width: 140px;\n    height: 14px;\n    background: linear-gradient(90deg, rgba(0, 0, 0, 0.8) 0%, rgba(0, 0, 0, 0.6) 100%);\n    border-radius: 7px;\n    overflow: hidden;\n    border: 1px solid rgba(255, 215, 0, 0.2);\n    box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.5);\n}\n\n.tv-hp-fill {\n    height: 100%;\n    background: linear-gradient(90deg, #ff0000 0%, #ff6b00 30%, #ffd700 100%);\n    transition: width 0.3s ease;\n    box-shadow: 0 0 15px rgba(255, 215, 0, 0.8);\n    position: relative;\n}\n\n.tv-hp-fill::after {\n    content: '';\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: linear-gradient(180deg, rgba(255, 255, 255, 0.3) 0%, transparent 50%, rgba(0, 0, 0, 0.2) 100%);\n}\n\n.tv-hp-text {\n    font-size: 1rem;\n    font-weight: 900;\n    color: var(--tv-accent-color);\n    text-shadow: 0 0 10px rgba(255, 215, 0, 0.7), 2px 2px 4px rgba(0, 0, 0, 0.8);\n    min-width: 60px;\n    letter-spacing: 1px;\n}\n\n.tv-player-gold {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    background: linear-gradient(135deg, rgba(255, 215, 0, 0.15) 0%, rgba(255, 215, 0, 0.05) 100%);\n    padding: 0.75rem 1.25rem;\n    border-radius: 6px;\n    border: 2px solid var(--tv-accent-color);\n    box-shadow: 0 0 20px rgba(255, 215, 0, 0.3), inset 0 1px 0 rgba(255, 255, 255, 0.2);\n}\n\n.tv-gold-text {\n    font-size: 1.25rem;\n    font-weight: 900;\n    color: var(--tv-accent-color);\n    text-shadow: 0 0 15px rgba(255, 215, 0, 0.8), 2px 2px 4px rgba(0, 0, 0, 0.8);\n}\n\n.tv-player-soul {\n    display: flex;\n    align-items: center;\n    gap: 0.5rem;\n    padding: 0.5rem;\n    background: rgba(0, 0, 0, 0.3);\n    border-radius: 6px;\n    border: 2px solid rgba(255, 215, 0, 0.2);\n}\n\n.tv-soul-image {\n    width: 32px;\n    height: 32px;\n    filter: drop-shadow(0 0 8px currentColor);\n}\n\n.tv-player-artifacts {\n    display: flex;\n    align-items: center;\n    gap: 0.75rem;\n    flex-wrap: wrap;\n}\n\n.tv-artifact-image {\n    width: 40px;\n    height: 40px;\n    border-radius: 6px;\n    border: 2px solid var(--tv-accent-color);\n    box-shadow: 0 0 15px rgba(255, 215, 0, 0.4);\n    filter: brightness(1.1);\n}\n\n.tv-artifact-counter {\n    position: absolute;\n    top: -6px;\n    right: -6px;\n    background: linear-gradient(135deg, #ff0000 0%, #ff6b00 100%);\n    color: white;\n    border: 2px solid var(--tv-accent-color);\n    border-radius: 50%;\n    width: 22px;\n    height: 22px;\n    font-size: 0.75rem;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    font-weight: 900;\n    box-shadow: 0 0 10px rgba(255, 0, 0, 0.6);\n}\n\n.tv-player-cards {\n    display: flex;\n    align-items: center;\n    gap: 1rem;\n    background: rgba(0, 0, 0, 0.3);\n    padding: 0.5rem 1rem;\n    border-radius: 6px;\n    border: 1px solid rgba(255, 215, 0, 0.2);\n}\n\n.tv-card-counter {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n}\n\n.tv-card-counter-label {\n    font-size: 0.625rem;\n    color: rgba(255, 215, 0, 0.6);\n    text-transform: uppercase;\n    font-weight: 700;\n    letter-spacing: 1px;\n}\n\n.tv-card-counter-value {\n    font-size: 1.125rem;\n    font-weight: 900;\n    color: var(--tv-accent-color);\n    text-shadow: 0 0 10px rgba(255, 215, 0, 0.6);\n}\n\n/* Center Info */\n.tv-center-info {\n    display: flex;\n    flex-direction: column;\n    align-items: center;\n    gap: 0.75rem;\n}\n\n.tv-turn-indicator {\n    background: linear-gradient(135deg, rgba(0, 0, 0, 0.7) 0%, rgba(0, 0, 0, 0.5) 100%);\n    padding: 0.75rem 2rem;\n    border-radius: 8px;\n    border: 3px solid var(--tv-accent-color);\n    box-shadow: 0 0 30px rgba(255, 215, 0, 0.5), inset 0 2px 0 rgba(255, 255, 255, 0.1);\n}\n\n.tv-turn-label {\n    font-size: 0.875rem;\n    color: rgba(255, 215, 0, 0.7);\n    text-transform: uppercase;\n    font-weight: 700;\n    letter-spacing: 2px;\n}\n\n.tv-turn-number {\n    font-size: 2rem;\n    font-weight: 900;\n    color: var(--tv-accent-color);\n    text-shadow: 0 0 20px rgba(255, 215, 0, 0.8), 3px 3px 6px rgba(0, 0, 0, 0.8);\n}\n\n.tv-turn-timer {\n    font-size: 1rem;\n    color: var(--tv-accent-color);\n    font-weight: 900;\n    text-shadow: 0 0 15px rgba(255, 215, 0, 0.7);\n    letter-spacing: 1px;\n}\n\n.tv-turn-timer.low {\n    color: #ff0000;\n    text-shadow: 0 0 20px rgba(255, 0, 0, 0.9);\n    animation: pulse-urgent 0.5s infinite;\n}\n\n@keyframes pulse-urgent {\n    0%, 100% { transform: scale(1); }\n    50% { transform: scale(1.1); }\n}\n\n/* Opponent Info */\n.tv-opponent-info {\n    display: flex;\n    align-items: center;\n    gap: 1.5rem;\n    flex: 1;\n    justify-content: flex-end;\n    flex-direction: row-reverse;\n    position: relative;\n}\n\n.tv-opponent-info.active-turn::before {\n    content: '';\n    position: absolute;\n    top: -12px;\n    left: -12px;\n    right: -12px;\n    bottom: -12px;\n    border: 4px solid var(--tv-accent-color);\n    border-radius: 8px;\n    box-shadow: 0 0 30px rgba(255, 215, 0, 0.6), inset 0 0 20px rgba(255, 215, 0, 0.2);\n    animation: pulse-glow 2s infinite;\n}\n\n/* Notificaciones dramáticas */\n.tv-notification {\n    position: fixed;\n    top: 110px;\n    right: 20px;\n    padding: 1.25rem 1.75rem;\n    border-radius: 8px;\n    color: white;\n    font-weight: 900;\n    font-size: 1.125rem;\n    text-transform: uppercase;\n    letter-spacing: 1px;\n    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.6), 0 0 30px rgba(255, 215, 0, 0.3);\n    z-index: 10001;\n    border: 2px solid var(--tv-accent-color);\n    background: linear-gradient(135deg, rgba(0, 0, 0, 0.9) 0%, rgba(26, 35, 50, 0.9) 100%);\n    max-width: 450px;\n}\n\n/* Panel de historial profesional */\n.tv-action-log {\n    position: fixed;\n    top: 110px;\n    right: 0;\n    width: 500px;\n    max-height: calc(100vh - 120px);\n    background: linear-gradient(135deg, rgba(10, 25, 41, 0.98) 0%, rgba(0, 8, 20, 0.98) 100%);\n    border-left: 4px solid var(--tv-accent-color);\n    box-shadow: -8px 0 32px rgba(0, 0, 0, 0.7);\n    z-index: 9999;\n    transition: transform 0.3s ease;\n    display: flex;\n    flex-direction: column;\n}\n\n.tv-action-log.collapsed {\n    transform: translateX(500px);\n}\n\n.tv-log-header {\n    display: flex;\n    justify-content: space-between;\n    align-items: center;\n    padding: 1rem 1.5rem;\n    background: linear-gradient(135deg, var(--tv-primary-color) 0%, var(--tv-secondary-color) 100%);\n    border-bottom: 3px solid var(--tv-accent-color);\n    color: var(--tv-accent-color);\n    font-weight: 900;\n    font-size: 1.25rem;\n    text-transform: uppercase;\n    letter-spacing: 2px;\n}\n\n.tv-log-toggle {\n    background: rgba(255, 215, 0, 0.2);\n    border: 2px solid var(--tv-accent-color);\n    color: var(--tv-accent-color);\n    width: 32px;\n    height: 32px;\n    border-radius: 6px;\n    cursor: pointer;\n    font-size: 1.125rem;\n    font-weight: 900;\n}\n\n.tv-log-content {\n    flex: 1;\n    overflow-y: auto;\n    padding: 0.75rem;\n}\n\n.tv-log-entry {\n    padding: 0.875rem 1.25rem;\n    margin-bottom: 0.75rem;\n    border-radius: 6px;\n    background: rgba(255, 215, 0, 0.05);\n    border-left: 4px solid var(--tv-accent-color);\n    font-size: 1rem;\n    color: rgba(255, 255, 255, 0.95);\n    line-height: 1.6;\n    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.3);\n}\n\n/* Botón flotante profesional */\n.tv-log-float-toggle {\n    position: fixed;\n    top: 110px;\n    right: 10px;\n    width: 48px;\n    height: 48px;\n    background: linear-gradient(135deg, var(--tv-primary-color) 0%, var(--tv-secondary-color) 100%);\n    border: 3px solid var(--tv-accent-color);\n    border-radius: 8px;\n    color: var(--tv-accent-color);\n    font-size: 1.5rem;\n    cursor: pointer;\n    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.5), 0 0 20px rgba(255, 215, 0, 0.3);\n    z-index: 10000;\n    font-weight: 900;\n}\n\n/* Result overlay dramático */\n.tv-result-overlay {\n    position: absolute;\n    top: 0;\n    left: 0;\n    right: 0;\n    bottom: 0;\n    background: linear-gradient(135deg, rgba(0, 8, 20, 0.95) 0%, rgba(10, 25, 41, 0.95) 100%);\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    pointer-events: auto;\n}\n\n.tv-result-container {\n    background: linear-gradient(135deg, var(--tv-primary-color) 0%, var(--tv-secondary-color) 100%);\n    border: 4px solid var(--tv-accent-color);\n    border-radius: 12px;\n    padding: 3rem 4rem;\n    box-shadow: 0 16px 48px rgba(0, 0, 0, 0.7), 0 0 60px rgba(255, 215, 0, 0.3);\n    text-align: center;\n    min-width: 500px;\n}\n\n.tv-result-title {\n    font-size: 4rem;\n    font-weight: 900;\n    margin-bottom: 2rem;\n    text-transform: uppercase;\n    letter-spacing: 4px;\n}\n\n.tv-result-title.victory {\n    color: var(--tv-accent-color);\n    text-shadow: 0 0 40px rgba(255, 215, 0, 0.9), 4px 4px 8px rgba(0, 0, 0, 0.8);\n}\n\n.tv-result-title.defeat {\n    color: #ff0000;\n    text-shadow: 0 0 40px rgba(255, 0, 0, 0.9), 4px 4px 8px rgba(0, 0, 0, 0.8);\n}\n\n.tv-result-stats {\n    display: flex;\n    flex-direction: column;\n    gap: 1rem;\n    margin-top: 2rem;\n}\n\n.tv-result-stat {\n    display: flex;\n    justify-content: space-between;\n    padding: 0.75rem 1.5rem;\n    background: rgba(0, 0, 0, 0.5);\n    border-radius: 6px;\n    border: 2px solid rgba(255, 215, 0, 0.3);\n}\n\n.tv-result-stat-label {\n    color: rgba(255, 215, 0, 0.7);\n    font-weight: 700;\n    text-transform: uppercase;\n}\n\n.tv-result-stat-value {\n    color: var(--tv-accent-color);\n    font-weight: 900;\n    font-size: 1.25rem;\n}\n\n/* Responsive */\n@media (max-width: 1280px) {\n    .tv-header {\n        height: 80px;\n        padding: 0 1rem;\n    }\n    \n    .tv-player-name {\n        font-size: 1.25rem;\n    }\n}\n\n@media (max-width: 768px) {\n    .tv-header {\n        height: auto;\n        flex-direction: column;\n        padding: 0.75rem;\n        gap: 0.75rem;\n    }\n    \n    .tv-player-info,\n    .tv-opponent-info {\n        width: 100%;\n    }\n}\n"}}};function l(e){try{if(0===e&&window.yourSoul)return window.yourSoul.name||window.yourSoul;if(1===e&&window.enemySoul)return window.enemySoul.name||window.enemySoul;const n=document.querySelectorAll('img[src*="souls"]');if(n&&n[e]){const t=n[e].src.match(/souls\/([^.]+)\.png/);if(t)return t[1].toUpperCase()}}catch(e){console.error("[TournamentView] Error capturando alma del DOM:",e)}return null}function s(e){try{const n=0===e?"yourArtifacts":"enemyArtifacts",t=document.getElementById(n);if(!t)return console.log("[TournamentView] getArtifactsFromDOM - No se encontró contenedor:",n),[];const a=t.querySelectorAll(".artifact-group");console.log(`[TournamentView] getArtifactsFromDOM - Player ${e}: ${a.length} artefactos encontrados`);const o=[];return a.forEach((e,n)=>{const t=e.querySelector(".artifact-img");if(t){const a={name:t.getAttribute("name")||"",image:t.getAttribute("image")||"",id:t.getAttribute("artifactid")||"",legendary:"true"===t.getAttribute("legendary")},r=e.querySelector(".artifact-custom");r?(a.counter=parseInt(r.textContent)||0,console.log(`  [${n}] ${a.name}: counter=${a.counter}`)):console.log(`  [${n}] ${a.name}: sin contador`),o.push(a)}}),o}catch(e){console.error("[TournamentView] Error capturando artefactos del DOM:",e)}return[]}function d(e){try{const n=document.querySelectorAll(".dust-counter");console.log("[TournamentView] getGraveyardFromDOM - playerIndex:",e,"Dust counters encontrados:",n.length),n.forEach((e,n)=>{console.log(`  DustCounter[${n}]:`,e.textContent.trim())});const t=0===e?1:0;if(n.length>t&&n[t]){const a=parseInt(n[t].textContent)||0;return console.log(`[TournamentView] Cementerio player ${e} (usando índice ${t}): ${a}`),a}const a=document.querySelectorAll("table tr");if(a&&a[e]){const n=a[e].querySelector(".dust-counter");if(n){const t=parseInt(n.textContent)||0;return console.log(`[TournamentView] Cementerio player ${e} (fallback): ${t}`),t}}console.log("[TournamentView] No se pudo encontrar cementerio en DOM")}catch(e){console.error("[TournamentView] Error capturando cementerio del DOM:",e)}return 0}function c(e){if(!e)return null;if(void 0!==e.count)return e.count;if(void 0!==e.counter)return e.counter;if(void 0!==e.value)return e.value;if(e.name){const n=e.name.match(/\((\d+)\)/);if(n)return parseInt(n[1])}return null}const p=new class{constructor(){this.container=null,this.elements={}}initialize(){this.container=document.createElement("div"),this.container.id="uc-tournament-view",document.body.appendChild(this.container),this.createHeader(),this.createActionLog(),console.log("[TournamentView] UI inicializada")}showFloatingNotification(e,n="info",t=3e3){const a=document.createElement("div");a.className="tv-notification tv-notification-"+n,a.textContent=e;const o=60*document.querySelectorAll(".tv-notification").length;a.style.top=90+o+"px",document.body.appendChild(a),setTimeout(()=>{a.classList.add("hiding"),setTimeout(()=>a.remove(),300)},t)}createActionLog(){const e=document.createElement("button");e.className="tv-log-float-toggle",e.innerHTML="📜",e.title=o.t("ui.toggleHistory"),document.body.appendChild(e),this.elements.logFloatToggle=e;const n=document.createElement("div");n.className="tv-action-log collapsed",n.innerHTML=`\n            <div class="tv-log-header">\n                <span>${o.t("ui.historyTitle")}</span>\n                <button class="tv-log-toggle">✕</button>\n            </div>\n            <div class="tv-log-content" data-log-content></div>\n        `,document.body.appendChild(n),this.elements.actionLog=n,this.elements.logContent=n.querySelector("[data-log-content]"),this.elements.logToggle=n.querySelector(".tv-log-toggle"),e.addEventListener("click",()=>this.toggleActionLog()),this.elements.logToggle.addEventListener("click",()=>this.toggleActionLog()),this.updateActionLog(),this.setupLogObserver()}setupLogObserver(){const e=document.querySelector("#history #log");e?(this.logObserver=new MutationObserver(()=>{this.updateActionLog()}),this.logObserver.observe(e,{childList:!0,subtree:!1}),console.log("[TournamentView] Observando historial de Underscript")):(console.warn("[TournamentView] No se encontró #history #log de Underscript"),setTimeout(()=>this.setupLogObserver(),2e3))}toggleActionLog(){this.elements.actionLog.classList.toggle("collapsed")}decodeHTMLEntities(e){const n=document.createElement("textarea");return n.innerHTML=e,n.value}translateLogHTML(e){if("es"!==o.currentLanguage)return e;let n=this.decodeHTMLEntities(e);n=n.replace(/(<[^>]+>.*?<\/[^>]+>)'s turn/gi,(e,n)=>"Es el turno de "+n);const t=[{pattern:/>>> Turn (\d+)/g,replacement:">>> Turno $1"},{pattern:/ played /g,replacement:" jugó "},{pattern:/ used /g,replacement:" usó "},{pattern:/ attacked /g,replacement:" atacó a "},{pattern:/ was killed/g,replacement:" fue eliminado"},{pattern:/ lost (\d+) hp/g,replacement:" perdió $1 hp"},{pattern:/ gained (\d+) hp/g,replacement:" ganó $1 hp"},{pattern:/\'s effect activated/g,replacement:": efecto activado"},{pattern:/\'s soul activated on /g,replacement:": alma activada en "},{pattern:/\'s soul activated/g,replacement:": alma activada"},{pattern:/ activated on /g,replacement:" activado en "},{pattern:/ activated/g,replacement:" activado"}];for(const{pattern:e,replacement:a}of t)n=n.replace(e,a);return n}parseLogEntry(e){const n=e.textContent||"",t=e.outerHTML||"";let a="info";return n.includes("Turn")?a="turn":n.includes("lost")&&n.includes("hp")?a="hp":n.includes("gained")&&n.includes("hp")?a="heal":n.includes("played")?a="card":n.includes("used")?a="spell":n.includes("activated")?a="artifact":n.includes("attacked")||n.includes("killed")?a="damage":n.includes("soul activated")&&(a="soul"),{html:t,text:n,type:a}}updateActionLog(){if(!this.elements.logContent)return;const e=document.querySelector("#history #log");if(!e)return void(this.elements.logContent.innerHTML=`<div class="tv-log-entry tv-log-entry-info">${o.t("ui.waitingHistory")}</div>`);const n=Array.from(e.children).slice(-50).reverse();0!==n.length?(this.elements.logContent.innerHTML="",n.forEach(e=>{const n="tv-log-entry-"+this.parseLogEntry(e).type,t=document.createElement("div");if(t.className="tv-log-entry "+n,"es"===o.currentLanguage){const n=this.translateLogHTML(e.innerHTML);t.innerHTML=n}else Array.from(e.childNodes).forEach(e=>{t.appendChild(e.cloneNode(!0))});this.elements.logContent.appendChild(t)}),setTimeout(()=>{this.elements.logContent&&(this.elements.logContent.scrollTop=this.elements.logContent.scrollHeight)},0)):this.elements.logContent.innerHTML=`<div class="tv-log-entry tv-log-entry-info">${o.t("ui.noActions")}</div>`}createHeader(){const e=document.createElement("div");e.className="tv-header";const n=document.createElement("div");n.className="tv-player-info",n.innerHTML=`\n            <div class="tv-player-name" data-player="player">Player</div>\n            <div class="tv-player-soul">\n                <div class="tv-soul-text" data-soul="player">-</div>\n            </div>\n            <div class="tv-player-hp">\n                <div class="tv-hp-bar">\n                    <div class="tv-hp-fill" data-hp-bar="player" style="width: 100%"></div>\n                </div>\n                <div class="tv-hp-text" data-hp-text="player">30/30</div>\n            </div>\n            <div class="tv-player-gold">\n                <div class="tv-gold-text" data-gold="player">0 G</div>\n            </div>\n            <div class="tv-player-artifacts">\n                <div class="tv-artifacts-text" data-artifacts="player">-</div>\n            </div>\n            <div class="tv-player-cards">\n                <div class="tv-card-counter">\n                    <div class="tv-card-counter-label">${o.t("ui.hand")}</div>\n                    <div class="tv-card-counter-value" data-hand="player">0</div>\n                </div>\n                <div class="tv-card-counter">\n                    <div class="tv-card-counter-label">${o.t("ui.deck")}</div>\n                    <div class="tv-card-counter-value" data-deck="player">0</div>\n                </div>\n                <div class="tv-card-counter">\n                    <div class="tv-card-counter-label">${o.t("ui.graveyard")}</div>\n                    <div class="tv-card-counter-value" data-graveyard="player">0</div>\n                </div>\n            </div>\n        `;const t=document.createElement("div");t.className="tv-center-info",t.innerHTML=`\n            <div class="tv-turn-indicator">\n                <div class="tv-turn-label">${o.t("ui.turn")}</div>\n                <div class="tv-turn-number" data-turn>0</div>\n                <div class="tv-turn-timer" data-timer>-</div>\n            </div>\n        `;const a=document.createElement("div");a.className="tv-opponent-info",a.innerHTML=`\n            <div class="tv-player-name" data-player="opponent">Opponent</div>\n            <div class="tv-player-soul">\n                <div class="tv-soul-text" data-soul="opponent">-</div>\n            </div>\n            <div class="tv-player-hp">\n                <div class="tv-hp-bar">\n                    <div class="tv-hp-fill" data-hp-bar="opponent" style="width: 100%"></div>\n                </div>\n                <div class="tv-hp-text" data-hp-text="opponent">30/30</div>\n            </div>\n            <div class="tv-player-gold">\n                <div class="tv-gold-text" data-gold="opponent">0 G</div>\n            </div>\n            <div class="tv-player-artifacts">\n                <div class="tv-artifacts-text" data-artifacts="opponent">-</div>\n            </div>\n            <div class="tv-player-cards">\n                <div class="tv-card-counter">\n                    <div class="tv-card-counter-label">${o.t("ui.hand")}</div>\n                    <div class="tv-card-counter-value" data-hand="opponent">0</div>\n                </div>\n                <div class="tv-card-counter">\n                    <div class="tv-card-counter-label">${o.t("ui.deck")}</div>\n                    <div class="tv-card-counter-value" data-deck="opponent">0</div>\n                </div>\n                <div class="tv-card-counter">\n                    <div class="tv-card-counter-label">${o.t("ui.graveyard")}</div>\n                    <div class="tv-card-counter-value" data-graveyard="opponent">0</div>\n                </div>\n            </div>\n        `,e.appendChild(n),e.appendChild(t),e.appendChild(a),this.container.appendChild(e),this.elements.playerName=n.querySelector('[data-player="player"]'),this.elements.opponentName=a.querySelector('[data-player="opponent"]'),this.elements.playerSoul=n.querySelector('[data-soul="player"]'),this.elements.opponentSoul=a.querySelector('[data-soul="opponent"]'),this.elements.playerHpBar=n.querySelector('[data-hp-bar="player"]'),this.elements.opponentHpBar=a.querySelector('[data-hp-bar="opponent"]'),this.elements.playerHpText=n.querySelector('[data-hp-text="player"]'),this.elements.opponentHpText=a.querySelector('[data-hp-text="opponent"]'),this.elements.playerGold=n.querySelector('[data-gold="player"]'),this.elements.opponentGold=a.querySelector('[data-gold="opponent"]'),this.elements.playerArtifacts=n.querySelector('[data-artifacts="player"]'),this.elements.opponentArtifacts=a.querySelector('[data-artifacts="opponent"]'),this.elements.playerHand=n.querySelector('[data-hand="player"]'),this.elements.opponentHand=a.querySelector('[data-hand="opponent"]'),this.elements.playerDeck=n.querySelector('[data-deck="player"]'),this.elements.opponentDeck=a.querySelector('[data-deck="opponent"]'),this.elements.playerGraveyard=n.querySelector('[data-graveyard="player"]'),this.elements.opponentGraveyard=a.querySelector('[data-graveyard="opponent"]'),this.elements.turnNumber=t.querySelector("[data-turn]"),this.elements.turnTimer=t.querySelector("[data-timer]")}updatePlayerNames(){this.elements.playerName&&r.player.username&&(this.elements.playerName.textContent=r.player.username),this.elements.opponentName&&r.opponent.username&&(this.elements.opponentName.textContent=r.opponent.username)}updateHP(e="player"){const n="player"===e?r.player:r.opponent,t=this.elements[e+"HpBar"],a=this.elements[e+"HpText"];if(t&&a&&n.maxHp>0){const r=n.hp/n.maxHp*100,i=r-(parseFloat(t.style.width)||100);if(t.style.width=r+"%",a.textContent=`${n.hp}/${n.maxHp}`,i<0){t.classList.add("hp-damage"),setTimeout(()=>t.classList.remove("hp-damage"),500);const a=n.username||("player"===e?o.t("player.default"):o.t("player.opponent")),r=Math.abs(Math.round(i*n.maxHp/100));this.showFloatingNotification(o.t("notif.receivedDamage",{player:a,damage:r}),"damage",2500)}else if(i>0){t.classList.add("hp-heal"),setTimeout(()=>t.classList.remove("hp-heal"),500);const a=n.username||("player"===e?o.t("player.default"):o.t("player.opponent")),r=Math.round(i*n.maxHp/100);this.showFloatingNotification(o.t("notif.healed",{player:a,heal:r}),"heal",2500)}}}updateGold(e="player"){const n="player"===e?r.player:r.opponent,t=this.elements[e+"Gold"];t&&(t.textContent=n.gold+" G")}updateTurn(){this.elements.turnNumber&&(this.elements.turnNumber.textContent=r.turn)}updateSoul(e="player"){const n="player"===e?r.player:r.opponent,t=this.elements[e+"Soul"];if(console.log(`[TournamentView] updateSoul(${e}) - Soul data:`,n.soul,"Type:",typeof n.soul),t)if(n.soul&&""!==n.soul){t.innerHTML="";const a=function(e){if(!e)return null;let n=null;if("string"==typeof e)try{const t=JSON.parse(e);n=t.name||t.id||t}catch(t){n=e}else e&&(e.name||e.id)&&(n=e.name||e.id);if(!n)return null;const t=document.querySelectorAll('img[src*="souls"]');console.log("[TournamentView] Buscando alma:",n,"Imágenes encontradas:",t.length);for(const e of t)if(console.log("[TournamentView] Imagen encontrada:",e.src),e.src.toLowerCase().includes(n.toLowerCase()))return console.log("[TournamentView] ¡Imagen coincide! Usando:",e.src),e.src;return console.log("[TournamentView] No se encontró en DOM, construyendo URL"),`images/souls/${n.toLowerCase()}.png`}(n.soul);if(console.log(`[TournamentView] updateSoul(${e}) - Image URL:`,a),a){const o=document.createElement("img");o.src=a,o.alt="string"==typeof n.soul?n.soul:n.soul.name,o.className="tv-soul-image",o.style.width="24px",o.style.height="24px",o.style.objectFit="contain",o.style.filter="drop-shadow(1px 1px 2px rgba(0, 0, 0, 0.8))",o.setAttribute(`data-${e}-soul`,"true"),o.onerror=()=>{console.error("[TournamentView] Error cargando imagen de alma:",a),t.textContent="string"==typeof n.soul?n.soul:n.soul.name},t.appendChild(o),t.title="Soul: "+("string"==typeof n.soul?n.soul:n.soul.name)}else t.textContent="string"==typeof n.soul?n.soul:n.soul.name,t.title="Soul: "+("string"==typeof n.soul?n.soul:n.soul.name)}else console.log(`[TournamentView] updateSoul(${e}) - No soul data, showing dash`),t.textContent="-";else console.error(`[TournamentView] updateSoul(${e}) - Element not found!`)}updateArtifacts(e="player"){const n="player"===e?r.player:r.opponent,t=this.elements[e+"Artifacts"];if(t)if(n.artifacts&&n.artifacts.length>0){t.innerHTML="",t.style.display="flex",t.style.gap="0.25rem",t.style.alignItems="center",n.artifacts.forEach((e,a)=>{const o=document.createElement("div");o.style.position="relative",o.style.display="inline-block";const r=function(e){if(!e)return null;if(e.image)return`https://undercards.net/images/artifacts/${e.image}.png`;if(e.id){const n=document.querySelector(`img[src*="artifacts"][src*="${e.id}"]`);return n?n.src:`https://undercards.net/images/artifacts/${e.id}.png`}return e.name?`https://undercards.net/images/artifacts/${e.name.toLowerCase().replace(/\s+/g,"_")}.png`:null}(e);if(r){const n=document.createElement("img");if(n.src=r,n.alt=e.name||"Artifact",n.className="tv-artifact-image",n.style.width="36px",n.style.height="36px",n.style.objectFit="contain",n.style.filter="drop-shadow(2px 2px 3px rgba(0, 0, 0, 0.9))",e.id&&n.setAttribute("data-artifact-id",e.id),n.onerror=()=>{o.innerHTML="";const n=document.createElement("span");n.textContent=e.name+(e.counter?`(${e.counter})`:""),n.style.fontSize="0.875rem",n.style.color="#a78bfa",n.style.fontWeight="bold",o.appendChild(n)},o.appendChild(n),e.counter){const n=document.createElement("div");n.textContent=e.counter,n.style.position="absolute",n.style.top="-6px",n.style.right="-6px",n.style.background="linear-gradient(135deg, #ef4444 0%, #dc2626 100%)",n.style.color="#ffffff",n.style.borderRadius="50%",n.style.width="22px",n.style.height="22px",n.style.display="flex",n.style.alignItems="center",n.style.justifyContent="center",n.style.fontSize="0.75rem",n.style.fontWeight="bold",n.style.border="2px solid #ffffff",n.style.boxShadow="0 3px 6px rgba(0, 0, 0, 0.5), inset 0 1px 2px rgba(255, 255, 255, 0.3)",n.style.textShadow="0 1px 2px rgba(0, 0, 0, 0.8)",o.appendChild(n)}o.title=e.name+(e.counter?` (${e.counter})`:"")}else{const n=document.createElement("span");n.textContent=e.name+(e.counter?`(${e.counter})`:""),n.style.fontSize="0.875rem",n.style.color="#a78bfa",n.style.fontWeight="bold",o.appendChild(n)}if(t.appendChild(o),a<n.artifacts.length-1){const e=document.createElement("span");e.textContent=",",e.style.fontSize="0.75rem",e.style.color="#666",e.style.marginRight="0.25rem",t.appendChild(e)}});const e=n.artifacts.map(e=>e.name+(e.counter?`(${e.counter})`:"")).join(", ");t.title=e}else t.textContent="-",t.title="Sin artefactos"}updateCards(e="player"){const n="player"===e?r.player:r.opponent,t=this.elements[e+"Hand"],a=this.elements[e+"Deck"],o=this.elements[e+"Graveyard"];t&&(t.textContent=n.handCount),a&&(a.textContent=n.deckCount),o&&(o.textContent=n.graveyardCount)}updateTimer(e){if(this.elements.turnTimer)if(null!=e&&e>=0){const n=`${Math.floor(e/60)}:${(e%60).toString().padStart(2,"0")}`;this.elements.turnTimer.textContent=n,e<=10?this.elements.turnTimer.classList.add("low"):this.elements.turnTimer.classList.remove("low")}else this.elements.turnTimer.textContent="-",this.elements.turnTimer.classList.remove("low")}updateActivePlayer(){const e=this.container.querySelector(".tv-player-info"),n=this.container.querySelector(".tv-opponent-info");console.log("[TournamentView] updateActivePlayer - Player ID:",r.player.id,"Opponent ID:",r.opponent.id,"Current:",r.currentPlayer),e&&n?(e.classList.remove("active-turn"),n.classList.remove("active-turn"),r.currentPlayer===r.player.id?(console.log("[TournamentView] Marcando JUGADOR como activo"),e.classList.add("active-turn")):r.currentPlayer===r.opponent.id?(console.log("[TournamentView] Marcando OPONENTE como activo"),n.classList.add("active-turn")):console.log("[TournamentView] Advertencia: currentPlayer no coincide con ningún ID")):console.error("[TournamentView] No se encontraron elementos playerInfo u opponentInfo")}showResult(e){const n=document.createElement("div");n.className="tv-result-overlay";const t="victory"===e?o.t("result.victory"):o.t("result.defeat"),a="victory"===e?"victory":"defeat";n.innerHTML=`\n            <div class="tv-result-container">\n                <div class="tv-result-title ${a}">${t}</div>\n                <div class="tv-result-stats">\n                    <div class="tv-result-stat">\n                        <span class="tv-result-stat-label">${o.t("ui.totalTurns")}</span>\n                        <span class="tv-result-stat-value">${r.turn}</span>\n                    </div>\n                    <div class="tv-result-stat">\n                        <span class="tv-result-stat-label">${o.t("ui.finalHP")}</span>\n                        <span class="tv-result-stat-value">${r.player.hp}/${r.player.maxHp}</span>\n                    </div>\n                </div>\n            </div>\n        `,this.container.appendChild(n),setTimeout(()=>{n.parentNode&&(n.style.opacity="0",setTimeout(()=>n.remove(),500))},5e3)}destroy(){this.container&&this.container.parentNode&&this.container.remove(),this.container=null,this.logObserver&&(this.logObserver.disconnect(),this.logObserver=null),this.elements.logFloatToggle&&this.elements.logFloatToggle.remove(),this.elements.actionLog&&this.elements.actionLog.remove(),this.elements={}}};let u=null;function m(){u&&clearInterval(u),console.log("[TournamentView] Iniciando timer watcher..."),u=setInterval(()=>{try{const e=window.global?window.global("time"):null;if(null!=e)return void p.updateTimer(Math.max(0,e));const n=document.querySelector(".timer.active");if(n){const e=n.querySelector(".white");if(e&&e.textContent){const n=e.textContent.trim().split(":");if(2===n.length){const e=parseInt(n[0])||0,t=60*e+(parseInt(n[1])||0);p.updateTimer(t)}}}else{const e=document.querySelector(".timer");if(e){const n=e.querySelector(".white");if(n&&n.textContent){const e=n.textContent.trim().split(":");if(2===e.length){const n=parseInt(e[0])||0,t=60*n+(parseInt(e[1])||0);p.updateTimer(t)}}}}}catch(e){console.error("[TournamentView] Error leyendo timer:",e)}},500)}const g=a.settings().add({key:"enabled",name:"Activar Tournament View",type:"boolean",default:!1}),v=a.settings().add({key:"language",name:"Idioma / Language",description:"Seleccionar idioma de la interfaz / Select interface language",type:"select",default:"es",data:["es","en"],onChange:e=>{console.log("[TournamentView] Cambiando idioma a:",e),o.setLanguage(e),p.container&&(console.log("[TournamentView] Regenerando UI con nuevo idioma"),p.destroy(),p.initialize(),r.isActive&&p.update())}});class f extends t.utils.SettingType{value(e){return e}encode(e){return e}default(){}}a.settings().addType(new class extends f{constructor(e="templateElement"){super(e)}element(e,n,{remove:t=!1}){const a=e&&e.active,o=e&&e.canDelete;console.log("[TemplateElement] Creando elemento con value:",e);const r=$(`<span class="glyphicon ${a?"glyphicon-star":"glyphicon-star-empty"}" \n            style="cursor: pointer; padding-right: 8px; color: ${a?"#5cb85c":"#999"};" \n            title="${a?"Plantilla activa":"Activar plantilla"}"></span>`).on("click",e=>{e.preventDefault(),console.log("[TemplateElement] Activar clicked"),n("activate")}),i=$('<span class="glyphicon glyphicon-download-alt" \n            style="cursor: pointer; padding-right: 8px; color: #337ab7;" \n            title="Exportar plantilla"></span>').on("click",e=>{e.preventDefault(),console.log("[TemplateElement] Exportar clicked"),n("export")});let l=r.add(i);if(o){const e=$('<span class="glyphicon glyphicon-trash" \n                style="cursor: pointer; padding-right: 8px; color: #d9534f;" \n                title="Eliminar plantilla"></span>').on("click",e=>{e.preventDefault(),console.log("[TemplateElement] Eliminar clicked"),n("delete")});l=l.add(e)}return l}labelFirst(){return!1}});function h(e){console.log("[TournamentView] Activando plantilla:",e);if(i.setActiveTemplate(e)){if(console.log("[TournamentView] Plantilla activada exitosamente"),i.injectCSS(),p.container&&(console.log("[TournamentView] Regenerando UI con nueva plantilla"),p.destroy(),p.initialize(),r.isActive)){console.log("[TournamentView] Restaurando datos visuales de la partida"),p.updatePlayerNames(),r.player.soul&&p.updateSoul("player",r.player.soul),r.opponent.soul&&p.updateSoul("opponent",r.opponent.soul),r.currentPlayer&&p.updateActivePlayer(r.currentPlayer);const e=getPlayersStats();p.updatePlayerStats(r.player.name,e.playerHp,e.playerMaxHp,e.playerGold,e.playerHand,e.playerDeck,e.playerGraveyard,e.playerArtifacts),p.updateOpponentStats(r.opponent.name,e.opponentHp,e.opponentMaxHp,e.opponentGold,e.opponentHand,e.opponentDeck,e.opponentGraveyard,e.opponentArtifacts);const n=r.getBoardState();p.updateBoard(n.playerBoard,n.opponentBoard),r.turn>0&&p.updateTurn(r.turn)}x()}else console.error("[TournamentView] Error al activar plantilla"),alert("❌ Error al activar plantilla")}a.settings().addType(new class extends f{constructor(e="fileInputElement"){super(e)}element(e,n,{remove:t=!1}){return $('<input type="file" accept="application/json,.json" style="margin: 5px 0;"/>').change(e=>{if(!e.target.files||!e.target.files[0])return;const n=e.target.files[0];console.log("[TournamentView] Procesando archivo:",n.name);const t=new FileReader;t.onload=e=>{try{const n=e.target.result,t=i.importTemplate(n);t.success?(console.log("[TournamentView] Plantilla importada exitosamente:",t.template.metadata.name),h(t.template.metadata.id),x(),alert(`✅ Plantilla "${t.template.metadata.name}" importada y activada exitosamente`)):(console.error("[TournamentView] Error al importar plantilla:",t.errors),alert("❌ Error al importar plantilla:\n\n"+t.errors.join("\n")))}catch(e){console.error("[TournamentView] Error al procesar archivo:",e),alert("❌ Error al procesar archivo: "+e.message)}},t.onerror=()=>{console.error("[TournamentView] Error al leer archivo"),alert("❌ Error al leer el archivo")},t.readAsText(n),e.target.value=""})}labelFirst(){return!0}});const y={};function x(){const e=i.templates,n=i.getActiveTemplateId(),t=["default","minimal","esports"];Object.keys(y).forEach(n=>{const t=n.replace("template_","");if(!e.find(e=>e.metadata.id===t)){$("#underscript\\.plugin\\."+("TournamentView."+n).replace(/\./g,"\\.")).parent().remove(),delete y[n]}}),e.forEach(e=>{const o=e.metadata.id,r="template_"+o,l=o===n,s=!t.includes(o);y[r]?y[r].set({active:l,canDelete:s}):y[r]=a.settings().add({key:r,name:e.metadata.name,description:e.metadata.description||`v${e.metadata.version} por ${e.metadata.author}`,type:"TournamentView:templateElement",category:"Plantillas",export:!1,default:{active:l,canDelete:s},onChange:(n,t)=>{if(console.log("[TournamentView] onChange llamado con action:",n),n)if(y[r].set(void 0),"activate"===n)h(o);else if("export"===n){console.log("[TournamentView] Exportando plantilla:",o);const n=i.exportTemplate(o);if(n.success){const t=new Blob([n.data],{type:"application/json"}),a=URL.createObjectURL(t),r=document.createElement("a");r.href=a,r.download=`template_${o}_${Date.now()}.json`,document.body.appendChild(r),r.click(),document.body.removeChild(r),URL.revokeObjectURL(a),console.log("[TournamentView] Plantilla exportada exitosamente"),alert(`✅ Plantilla "${e.metadata.name}" exportada exitosamente`)}else console.error("[TournamentView] Error al exportar plantilla:",n.error),alert("❌ Error al exportar: "+n.error)}else if("delete"===n){if(!s)return void alert("❌ No se pueden eliminar las plantillas predefinidas");if(confirm(`¿Seguro que deseas eliminar la plantilla "${e.metadata.name}"?`)){console.log("[TournamentView] Eliminando plantilla:",o),l&&h("default"),i.deleteTemplate(o);$("#"+("underscript\\.plugin\\.TournamentView\\."+r)).parent().remove(),delete y[r],alert(`✅ Plantilla "${e.metadata.name}" eliminada`)}}}})})}a.settings().add({key:"importTemplate",name:"Importar Plantilla",description:"Selecciona un archivo JSON para importar una plantilla personalizada",type:"TournamentView:fileInputElement",category:"Plantillas",export:!1}),x(),console.log("[TournamentView] Setting creado - isEnabled:",g),console.log("[TournamentView] Setting creado - isEnabled.value():",g.value()),console.log("[TournamentView] Setting creado - typeof isEnabled.value():",typeof g.value()),g.on("change",e=>{console.log("[TournamentView] Setting cambiado a:",e),e?(console.log("[TournamentView] Activando plugin..."),t.onPage("Spectate")&&(r.isSpectate=!0,i.injectCSS(),p.initialize(),console.log("[TournamentView] Plugin activado"))):(console.log("[TournamentView] Desactivando plugin..."),u&&(clearInterval(u),u=null),p.destroy(),i.removeCSS(),r.reset(),console.log("[TournamentView] Plugin desactivado"))}),a.events.on(":preload",()=>{try{const e=v.value();e?(o.setLanguage(e),console.log("[TournamentView] Idioma inicializado:",e)):console.log("[TournamentView] No hay idioma guardado, usando default: es")}catch(e){console.error("[TournamentView] Error inicializando idioma:",e)}console.log("[TournamentView] :preload - isEnabled.value():",g.value()),g.value()?t.onPage("Spectate")?(r.isSpectate=!0,console.log("[TournamentView] Plugin cargado en modo Spectate"),i.injectCSS(),p.initialize()):console.log("[TournamentView] No estamos en Spectate, plugin inactivo"):console.log("[TournamentView] Plugin DESACTIVADO - No se iniciará")}),a.events.on("connect",e=>{if(console.log("[TournamentView] connect - isEnabled.value():",g.value(),"isSpectate:",r.isSpectate),g.value()&&r.isSpectate){console.log("[TournamentView] Conexión establecida:",e);try{const n=e.you?JSON.parse(e.you):null,t=e.enemy?JSON.parse(e.enemy):null,a=e.golds?JSON.parse(e.golds):{};if(void 0!==e.turn&&null!==e.turn&&(r.turn=parseInt(e.turn)||0,console.log("[TournamentView] Turno inicial capturado:",r.turn)),void 0!==e.userTurn&&(r.currentPlayer=e.userTurn,console.log("[TournamentView] Turno activo de:",e.userTurn)),n&&(r.player.id=n.id,r.player.username=n.username||o.t("player.default"),r.player.hp=n.hp||30,r.player.maxHp=n.maxHp||30,r.player.gold=a[n.id]||0,r.player.soul=e.yourSoul||l(0)||"",r.player.soulLives=0,console.log("[TournamentView] Player soul captured:",r.player.soul,"Type:",typeof r.player.soul),e.artifacts))try{const t=JSON.parse(e.artifacts);t[n.id]&&(r.player.artifacts=t[n.id],console.log("[TournamentView] Artefactos del jugador:",r.player.artifacts),r.player.artifacts.forEach(e=>{const n=c(e);console.log(`  - ${e.name}:`,"counter:",n,"image:",e.image,"id:",e.id),null!==n&&(e.counter=n)}))}catch(e){console.error("[TournamentView] Error parseando artefactos del jugador:",e)}if(t&&(r.opponent.id=t.id,r.opponent.username=t.username||o.t("player.opponent"),r.opponent.hp=t.hp||30,r.opponent.maxHp=t.maxHp||30,r.opponent.gold=a[t.id]||0,r.opponent.soul=e.enemySoul||l(1)||"",r.opponent.soulLives=0,console.log("[TournamentView] Opponent soul captured:",r.opponent.soul,"Type:",typeof r.opponent.soul),e.artifacts))try{const n=JSON.parse(e.artifacts);n[t.id]&&(r.opponent.artifacts=n[t.id],console.log("[TournamentView] Artefactos del oponente:",r.opponent.artifacts),r.opponent.artifacts.forEach(e=>{const n=c(e);console.log(`  - ${e.name}:`,"counter:",n,"image:",e.image,"id:",e.id),null!==n&&(e.counter=n)}))}catch(e){console.error("[TournamentView] Error parseando artefactos del oponente:",e)}if(e.handsSize)try{const a=JSON.parse(e.handsSize);n&&void 0!==a[n.id]&&(r.player.handCount=a[n.id]),t&&void 0!==a[t.id]&&(r.opponent.handCount=a[t.id])}catch(e){console.error("[TournamentView] Error parseando handsSize inicial:",e)}if(e.decksSize)try{const a=JSON.parse(e.decksSize);n&&void 0!==a[n.id]&&(r.player.deckCount=a[n.id]),t&&void 0!==a[t.id]&&(r.opponent.deckCount=a[t.id])}catch(e){console.error("[TournamentView] Error parseando decksSize inicial:",e)}if(e.graveyardsSize)try{const a=JSON.parse(e.graveyardsSize);n&&void 0!==a[n.id]?r.player.graveyardCount=a[n.id]:n&&(r.player.graveyardCount=d(0)),t&&void 0!==a[t.id]?r.opponent.graveyardCount=a[t.id]:t&&(r.opponent.graveyardCount=d(1))}catch(e){console.error("[TournamentView] Error parseando graveyardsSize inicial:",e),n&&(r.player.graveyardCount=d(0)),t&&(r.opponent.graveyardCount=d(1))}else n&&(r.player.graveyardCount=d(0)),t&&(r.opponent.graveyardCount=d(1));console.log("[TournamentView] Jugador:",r.player.username,`[${r.player.soul}]`,`(${r.player.hp} HP, ${r.player.gold} G)`,`Cartas: ${r.player.handCount}/${r.player.deckCount}/${r.player.graveyardCount}`,r.player.artifacts.length>0?"Artefactos: "+r.player.artifacts.length:""),console.log("[TournamentView] Oponente:",r.opponent.username,`[${r.opponent.soul}]`,`(${r.opponent.hp} HP, ${r.opponent.gold} G)`,`Cartas: ${r.opponent.handCount}/${r.opponent.deckCount}/${r.opponent.graveyardCount}`,r.opponent.artifacts.length>0?"Artefactos: "+r.opponent.artifacts.length:""),p.updatePlayerNames(),p.updateHP("player"),p.updateHP("opponent"),p.updateGold("player"),p.updateGold("opponent"),p.updateSoul("player"),p.updateSoul("opponent"),p.updateArtifacts("player"),p.updateArtifacts("opponent"),p.updateCards("player"),p.updateCards("opponent"),p.updateTurn(),p.updateActivePlayer(),m()}catch(e){console.error("[TournamentView] Error parseando datos de conexión:",e)}}else console.log("[TournamentView] connect - Plugin desactivado o no en modo espectador, ignorando evento")}),a.events.on("GameStart",e=>{console.log("[TournamentView] GameStart - isEnabled.value():",g.value(),"isSpectate:",r.isSpectate),g.value()&&r.isSpectate?(console.log("[TournamentView] Partida iniciada:",e),r.isActive=!0,r.turn=0,p.updateTurn()):console.log("[TournamentView] GameStart - Ignorando evento (desactivado o no espectador)")}),a.events.on("getTurnStart",e=>{console.log("[TournamentView] getTurnStart - isEnabled.value():",g.value(),"isActive:",r.isActive),g.value()&&r.isActive?(window.global&&void 0!==window.global("turn")?r.turn=window.global("turn"):void 0!==e.numTurn?r.turn=parseInt(e.numTurn):void 0!==e.turn&&(r.turn=parseInt(e.turn)),void 0!==e.idPlayer?r.currentPlayer=e.idPlayer:void 0!==e.playerId&&(r.currentPlayer=e.playerId),console.log(`[TournamentView] Turno ${r.turn} iniciado`),console.log(`[TournamentView] IDs - Player: ${r.player.id}, Opponent: ${r.opponent.id}, Current: ${r.currentPlayer}`),p.updateActivePlayer(),m(),p.updateTurn()):console.log("[TournamentView] getTurnStart - Ignorando evento")}),a.events.on("getUpdatePlayerHp",e=>{g.value()&&r.isActive&&(e.playerId===r.player.id?(r.updatePlayer({hp:e.hp,maxHp:e.maxHp}),p.updateHP("player")):e.playerId===r.opponent.id&&(r.updateOpponent({hp:e.hp,maxHp:e.maxHp}),p.updateHP("opponent")),console.log("[TournamentView] HP actualizado:",e))}),a.events.on("getPlayersStats",e=>{if(g.value()&&r.isActive)try{if(e.golds){const n=JSON.parse(e.golds);r.player.id&&void 0!==n[r.player.id]&&(r.player.gold=n[r.player.id],p.updateGold("player")),r.opponent.id&&void 0!==n[r.opponent.id]&&(r.opponent.gold=n[r.opponent.id],p.updateGold("opponent"))}if(e.handsSize){const n=JSON.parse(e.handsSize);r.player.id&&void 0!==n[r.player.id]&&(r.player.handCount=n[r.player.id],p.updateCards("player")),r.opponent.id&&void 0!==n[r.opponent.id]&&(r.opponent.handCount=n[r.opponent.id],p.updateCards("opponent"))}if(e.decksSize){const n=JSON.parse(e.decksSize);r.player.id&&void 0!==n[r.player.id]&&(r.player.deckCount=n[r.player.id],p.updateCards("player")),r.opponent.id&&void 0!==n[r.opponent.id]&&(r.opponent.deckCount=n[r.opponent.id],p.updateCards("opponent"))}if(e.graveyardsSize){const n=JSON.parse(e.graveyardsSize);console.log("[TournamentView] graveyardsSize recibido:",n),r.player.id&&void 0!==n[r.player.id]&&(r.player.graveyardCount=n[r.player.id],console.log("[TournamentView] Cementerio player actualizado a:",r.player.graveyardCount),p.updateCards("player")),r.opponent.id&&void 0!==n[r.opponent.id]&&(r.opponent.graveyardCount=n[r.opponent.id],console.log("[TournamentView] Cementerio opponent actualizado a:",r.opponent.graveyardCount),p.updateCards("opponent"))}else{console.log("[TournamentView] No graveyardsSize en getPlayersStats, intentando leer del DOM");const e=d(0),n=d(1);e!==r.player.graveyardCount&&(r.player.graveyardCount=e,console.log("[TournamentView] Cementerio player actualizado desde DOM a:",e),p.updateCards("player")),n!==r.opponent.graveyardCount&&(r.opponent.graveyardCount=n,console.log("[TournamentView] Cementerio opponent actualizado desde DOM a:",n),p.updateCards("opponent"))}console.log("[TournamentView] Leyendo artefactos desde DOM...");const n=s(0),t=s(1),a=JSON.stringify(r.player.artifacts);a!==JSON.stringify(n)&&n.length>0&&(r.player.artifacts=n,console.log("[TournamentView] Artefactos del jugador actualizados desde DOM:",n.map(e=>`${e.name}${e.counter?`(${e.counter})`:""}`).join(", ")),p.updateArtifacts("player"));const o=JSON.stringify(r.opponent.artifacts);o!==JSON.stringify(t)&&t.length>0&&(r.opponent.artifacts=t,console.log("[TournamentView] Artefactos del oponente actualizados desde DOM:",t.map(e=>`${e.name}${e.counter?`(${e.counter})`:""}`).join(", ")),p.updateArtifacts("opponent"));const i=r.player.artifacts.length>0?` | ${r.player.artifacts.length} artefactos`:"",l=r.opponent.artifacts.length>0?` | ${r.opponent.artifacts.length} artefactos`:"";console.log(`[TournamentView] Stats - P: ${r.player.gold}G, ${r.player.handCount} cartas${i} | O: ${r.opponent.gold}G, ${r.opponent.handCount} cartas${l}`)}catch(e){console.error("[TournamentView] Error parseando stats:",e)}}),a.events.on("getUpdateBoard",e=>{if(g.value()&&r.isActive)try{const n=JSON.parse(e.board);let t=0,a=0;n.forEach((e,n)=>{e&&(e.ownerId===r.player.id?t++:e.ownerId===r.opponent.id&&a++)}),r.player.boardCount=t,r.opponent.boardCount=a,console.log("[TournamentView] Tablero actualizado - P:",t,"cartas | O:",a,"cartas")}catch(e){console.error("[TournamentView] Error parseando tablero:",e)}}),a.events.on("getVictory",e=>{g.value()&&r.isActive&&(r.gameResult="victory",console.log("[TournamentView] Victoria detectada"),p.showResult("victory"))}),a.events.on("getDefeat",e=>{g.value()&&r.isActive&&(r.gameResult="defeat",console.log("[TournamentView] Derrota detectada"),p.showResult("defeat"))}),a.events.on("getResult",e=>{g.value()&&r.isActive&&(console.log("[TournamentView] Partida finalizada:",e),setTimeout(()=>{const e=r.getState();console.log("[TournamentView] Estado final:",e)},1e3))}),a.events.on("getCardBoard",e=>{if(g.value()&&r.isActive)try{const n=JSON.parse(e.card),t=e.idPlayer===r.player.id?r.player.username:r.opponent.username;console.log(`[TournamentView] ${t} jugó: ${n.name}`),p.showFloatingNotification(`${t} jugó ${n.name}`,"card",3e3)}catch(e){console.error("[TournamentView] Error parseando carta:",e)}}),a.events.on("getSpellPlayed",e=>{if(g.value()&&r.isActive)try{const n=JSON.parse(e.card),t=e.idPlayer===r.player.id?r.player.username:r.opponent.username;console.log(`[TournamentView] ${t} usó hechizo: ${n.name}`),p.showFloatingNotification(`${t} usó ${n.name}`,"spell",3e3)}catch(e){console.error("[TournamentView] Error parseando hechizo:",e)}}),a.events.on("getMonsterDestroyed",e=>{g.value()&&r.isActive&&(console.log("[TournamentView] Monstruo destruido, ID:",e.monsterId),p.showFloatingNotification("Monstruo destruido","damage",2e3))}),a.events.on("getUpdateSoul",e=>{if(g.value()&&r.isActive)try{const n=JSON.parse(e.soul);e.idPlayer===r.player.id?(r.player.soulLives=n.lives||0,console.log(`[TournamentView] Alma del jugador actualizada: ${r.player.soul} (Vidas: ${n.lives}, Esquiva: ${n.dodge||0})`),p.updateSoul("player")):e.idPlayer===r.opponent.id&&(r.opponent.soulLives=n.lives||0,console.log(`[TournamentView] Alma del oponente actualizada: ${r.opponent.soul} (Vidas: ${n.lives}, Esquiva: ${n.dodge||0})`),p.updateSoul("opponent"))}catch(e){console.error("[TournamentView] Error parseando actualización de alma:",e)}}),a.events.on("Log:ARTIFACT_EFFECT",e=>{if(g.value()&&r.isActive)try{const n=e.artifactActor&&e.artifactActor.name||"Artefacto desconocido",t=e.playerId===r.player.id?r.player.username:r.opponent.username;if(console.log(`[TournamentView] ${t} activó artefacto: ${n}`),p.showFloatingNotification(`${t} activó ${n}`,"artifact",3e3),e.artifactActor&&e.artifactActor.id){document.querySelectorAll(`.tv-artifact-image[data-artifact-id="${e.artifactActor.id}"]`).forEach(e=>{e.classList.add("artifact-glow"),setTimeout(()=>e.classList.remove("artifact-glow"),1200)})}e.targetCards&&e.targetCards.length>0&&console.log("[TournamentView] Afectó a cartas:",e.targetCards.length),e.targetPlayers&&e.targetPlayers.length>0&&console.log("[TournamentView] Afectó a jugadores:",e.targetPlayers.length)}catch(e){console.error("[TournamentView] Error procesando efecto de artefacto:",e)}}),a.events.on("Log:SOUL_EFFECT",e=>{if(g.value()&&r.isActive)try{const n=e.playerId===r.player.id,t=n?r.player.username:r.opponent.username,a=n?r.player.soul:r.opponent.soul;console.log(`[TournamentView] ${t} activó efecto del alma: ${a}`),p.showFloatingNotification(t+" activó efecto de alma","info",2500);const o=n?"[data-player-soul]":"[data-opponent-soul]",i=document.querySelector(o);i&&(i.classList.add("soul-glow"),setTimeout(()=>i.classList.remove("soul-glow"),1e3))}catch(e){console.error("[TournamentView] Error procesando efecto del alma:",e)}}),a.events.on("getTurnEnd",e=>{g.value()&&r.isActive&&(u&&(clearInterval(u),u=null),p.updateTimer(null),console.log("[TournamentView] Turno finalizado"))}),a.events.on("refreshTimer",e=>{if(g.value()&&r.isActive)try{if(void 0!==e.time&&null!==e.time){const n=parseInt(e.time);p.updateTimer(Math.max(0,n))}}catch(e){console.error("[TournamentView] Error procesando timer:",e)}})}]);